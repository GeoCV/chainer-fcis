# COCO instance segmentation

![Example](../../static/coco_example.png)

## Inference

Trained model can be dowloaded [here](https://drive.google.com/open?id=0B5DV6gwLHtyJZTR0NFllNGlwS3M).

This model is converted from one trained by original repo.

```bash
# Pretrained model will be downloaded automatically
# or run below.
# python download_models.py
python demo.py
```

## Training

***Work in progress***

### Caution

COCO training requires very long time.
If you only have 1 GPU, I recommend to try VOC training first.

### Requirements
- [Cython](http://cython.org/)
- [pycocotools](https://github.com/cocodataset/cocoapi)
- [OpenMPI](https://www.open-mpi.org/)
- [nccl](https://developer.nvidia.com/nccl)
- [ChainerMN](https://github.com/chainer/chainermn)

```bash
# Download datasets manually in ~/data/datasets/coco
# or run below.
# python download_datasets.py --all

mpiexec -n <gpu_num> python train.py
```

## Evaluation

This is evaluation of model trained by this repo.

```bash
# Download datasets manually in ~/data/datasets/coco
# or run below.
# python download_datasets.py --val

python evaluate.py
```

| Implementation | Sampling Strategy | mAP/iou@[0.5:0.95] | mAP/iou@0.5 | mAP/iou@[0.5:0.95] \(small) | mAP/iou@[0.5:0.95] \(medium) | mAP/iou@[0.5:0.95] \(large) |
|:--------------:|:-----------------:|:------------------:|:-----------:|:---------------------------:|:----------------------------:|:---------------------------:|
| [Original](https://github.com/msracver/FCIS) | OHEM | 0.292 | 0.495 | 0.071 | 0.313 | 0.500 |
| [Original](https://github.com/msracver/FCIS) | Random | 0.288 | 0.487 | 0.068 | 0.308 | 0.495 |
| Ours | Random | 0.229 | 0.415 | 0.049 | 0.231 | 0.422 |

**Our Trained Model Evaluation**

| Item | AP/iou@[0.5:0.95] | AP/iou@0.5 | AP/iou@0.75 | AP/iou@[0.5:0.95] \(small) | AP/iou@[0.5:0.95] \(medium) | AP/iou@[0.5:0.95] \(large) |
|:----:|:-----------------:|:----------:|:-----------:|:--------------------------:|:---------------------------:|:--------------------------:|
| **mean**       | 0.229  | 0.415  | 0.226  | 0.049  | 0.231  | 0.422  |
| person         | 0.2797 | 0.5862 | 0.2378 | 0.0667 | 0.3143 | 0.5469 |
| bicycle        | 0.1052 | 0.2829 | 0.0592 | 0.0112 | 0.1205 | 0.3346 |
| car            | 0.2212 | 0.4405 | 0.1987 | 0.0936 | 0.3877 | 0.5503 |
| motorcycle     | 0.2003 | 0.4301 | 0.1779 | 0.0349 | 0.1230 | 0.3807 |
| airplane       | 0.3169 | 0.6793 | 0.3275 | 0.0471 | 0.2554 | 0.4792 |
| bus            | 0.5105 | 0.7086 | 0.5559 | 0.0813 | 0.2678 | 0.7100 |
| train          | 0.5325 | 0.7780 | 0.5960 | 0.1663 | 0.2225 | 0.5771 |
| truck          | 0.1993 | 0.3720 | 0.1918 | 0.0421 | 0.1579 | 0.3919 |
| boat           | 0.1220 | 0.3129 | 0.0789 | 0.0305 | 0.1258 | 0.3864 |
| traffic light  | 0.1294 | 0.3135 | 0.0917 | 0.0774 | 0.3326 | 0.4286 |
| fire hydrant   | 0.4781 | 0.7536 | 0.5243 | 0.1184 | 0.4995 | 0.6782 |
| stop sign      | 0.4956 | 0.6157 | 0.5690 | 0.0531 | 0.5401 | 0.8841 |
| parking meter  | 0.3176 | 0.5203 | 0.3540 | 0.0699 | 0.2649 | 0.5700 |
| bench          | 0.0980 | 0.2174 | 0.0797 | 0.0198 | 0.0974 | 0.2114 |
| bird           | 0.1480 | 0.3064 | 0.1354 | 0.0269 | 0.3333 | 0.5554 |
| cat            | 0.5823 | 0.8883 | 0.7067 | 0.0040 | 0.4662 | 0.6263 |
| dog            | 0.4641 | 0.7518 | 0.5295 | 0.1345 | 0.3995 | 0.5486 |
| horse          | 0.2991 | 0.6303 | 0.2068 | 0.0137 | 0.2512 | 0.4791 |
| sheep          | 0.2829 | 0.5418 | 0.2507 | 0.0550 | 0.3504 | 0.4412 |
| cow            | 0.2849 | 0.5756 | 0.2362 | 0.1082 | 0.3195 | 0.5313 |
| elephant       | 0.4242 | 0.7558 | 0.4129 | 0.1418 | 0.3349 | 0.5247 |
| bear           | 0.6001 | 0.8331 | 0.7124 | 0.1866 | 0.5336 | 0.6607 |
| zebra          | 0.4129 | 0.7596 | 0.4192 | 0.1162 | 0.3565 | 0.5684 |
| giraffe        | 0.3544 | 0.7861 | 0.2704 | 0.0735 | 0.3238 | 0.4508 |
| backpack       | 0.0497 | 0.1112 | 0.0478 | 0.0220 | 0.0871 | 0.1346 |
| umbrella       | 0.2616 | 0.4580 | 0.2744 | 0.0334 | 0.2647 | 0.5541 |
| handbag        | 0.0374 | 0.1062 | 0.0192 | 0.0093 | 0.0751 | 0.1231 |
| tie            | 0.1194 | 0.2492 | 0.1074 | 0.0273 | 0.2183 | 0.4177 |
| suitcase       | 0.1800 | 0.3258 | 0.1998 | 0.0320 | 0.1674 | 0.3845 |
| frisbee        | 0.3445 | 0.6298 | 0.3461 | 0.2225 | 0.4669 | 0.7887 |
| skis           | 0.0025 | 0.0160 | 0.0000 | 0.0007 | 0.0105 | 0.0000 |
| snowboard      | 0.0956 | 0.2140 | 0.0472 | 0.0057 | 0.1962 | 0.3574 |
| sports ball    | 0.2361 | 0.4037 | 0.2772 | 0.1859 | 0.5624 | 0.5976 |
| kite           | 0.0989 | 0.2810 | 0.0480 | 0.0588 | 0.1800 | 0.2886 |
| baseball bat   | 0.0536 | 0.2044 | 0.0073 | 0.0321 | 0.1025 | 0.0000 |
| baseball glove | 0.1972 | 0.3962 | 0.1836 | 0.1192 | 0.3348 | 0.4072 |
| skateboard     | 0.1221 | 0.3623 | 0.0358 | 0.0345 | 0.1871 | 0.3104 |
| surfboard      | 0.1504 | 0.3847 | 0.1048 | 0.0307 | 0.2130 | 0.3245 |
| tennis racket  | 0.2966 | 0.5867 | 0.2541 | 0.0881 | 0.3887 | 0.6408 |
| bottle         | 0.1737 | 0.3459 | 0.1481 | 0.0573 | 0.3361 | 0.5454 |
| wine glass     | 0.1512 | 0.3033 | 0.1369 | 0.0220 | 0.2275 | 0.6190 |
| cup            | 0.2299 | 0.3946 | 0.2427 | 0.0667 | 0.3373 | 0.5669 |
| fork           | 0.0443 | 0.1646 | 0.0049 | 0.0001 | 0.0703 | 0.1657 |
| knife          | 0.0233 | 0.0586 | 0.0086 | 0.0029 | 0.0651 | 0.0986 |
| spoon          | 0.0198 | 0.0542 | 0.0142 | 0.0019 | 0.0400 | 0.1531 |
| bowl           | 0.2299 | 0.3936 | 0.2538 | 0.0522 | 0.2352 | 0.4310 |
| banana         | 0.0907 | 0.2235 | 0.0664 | 0.0165 | 0.0871 | 0.2366 |
| apple          | 0.1029 | 0.1906 | 0.0924 | 0.0153 | 0.1301 | 0.3083 |
| sandwich       | 0.2755 | 0.4189 | 0.2968 | 0.0198 | 0.1182 | 0.4137 |
| orange         | 0.1829 | 0.3003 | 0.1871 | 0.0359 | 0.1744 | 0.4510 |
| broccoli       | 0.1054 | 0.2398 | 0.0804 | 0.0000 | 0.1101 | 0.1969 |
| carrot         | 0.0774 | 0.1660 | 0.0626 | 0.0238 | 0.1240 | 0.1642 |
| hot dog        | 0.1391 | 0.2764 | 0.1386 | 0.0003 | 0.0797 | 0.3797 |
| pizza          | 0.3621 | 0.5771 | 0.4169 | 0.0088 | 0.2620 | 0.5319 |
| donut          | 0.2641 | 0.4012 | 0.2828 | 0.0837 | 0.2212 | 0.7000 |
| cake           | 0.2118 | 0.3808 | 0.2183 | 0.0251 | 0.2388 | 0.3682 |
| chair          | 0.0796 | 0.2029 | 0.0579 | 0.0125 | 0.0844 | 0.2488 |
| couch          | 0.2955 | 0.5012 | 0.3077 | 0.0006 | 0.1130 | 0.3665 |
| potted plant   | 0.0979 | 0.2595 | 0.0595 | 0.0291 | 0.1195 | 0.1783 |
| bed            | 0.2392 | 0.4928 | 0.1920 | 0.0000 | 0.0318 | 0.2619 |
| dining table   | 0.0996 | 0.1782 | 0.1018 | 0.0004 | 0.0158 | 0.1607 |
| toilet         | 0.4892 | 0.7418 | 0.5524 | 0.0004 | 0.3481 | 0.5753 |
| tv             | 0.4356 | 0.6472 | 0.5132 | 0.0239 | 0.3841 | 0.5922 |
| laptop         | 0.4597 | 0.6544 | 0.5170 | 0.0501 | 0.2567 | 0.6478 |
| mouse          | 0.3656 | 0.6197 | 0.3956 | 0.2335 | 0.4803 | 0.5904 |
| remote         | 0.0755 | 0.1778 | 0.0521 | 0.0226 | 0.1783 | 0.4365 |
| keyboard       | 0.3356 | 0.5990 | 0.3588 | 0.0430 | 0.2987 | 0.4791 |
| cell phone     | 0.1628 | 0.3046 | 0.1574 | 0.0197 | 0.2656 | 0.5552 |
| microwave      | 0.3844 | 0.5942 | 0.3833 | 0.0000 | 0.3268 | 0.5942 |
| oven           | 0.2073 | 0.3855 | 0.2035 | 0.0000 | 0.1165 | 0.2904 |
| toaster        | 0.1471 | 0.2731 | 0.1430 | 0.0418 | 0.1960 | 0.4904 |
| sink           | 0.2215 | 0.4653 | 0.2091 | 0.0472 | 0.2845 | 0.3213 |
| refrigerator   | 0.3724 | 0.5949 | 0.3933 | 0.0000 | 0.1233 | 0.4534 |
| book           | 0.0224 | 0.0575 | 0.0153 | 0.0059 | 0.0477 | 0.1107 |
| clock          | 0.3457 | 0.6392 | 0.3566 | 0.1852 | 0.4674 | 0.5134 |
| vase           | 0.1878 | 0.3758 | 0.1589 | 0.0588 | 0.2204 | 0.4614 |
| scissors       | 0.1236 | 0.2914 | 0.0484 | 0.0000 | 0.1665 | 0.2296 |
| teddy bear     | 0.3097 | 0.5418 | 0.3374 | 0.0019 | 0.2302 | 0.4669 |
| hair drier     | 0.0000 | 0.0000 | 0.0000 | 0.0000 | 0.0000 | 0.0000 |
| toothbrush     | 0.0375 | 0.1156 | 0.0091 | 0.0000 | 0.0636 | 0.5418 |

## Dataset Download

- [COCO](http://cocodataset.org/)

```bash
# Dataset will be downloaded to ~/data/datasets/coco
python download_datasets.py --all
```
